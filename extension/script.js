function Torrent(e,t,r){if(this.link=e,this.name=t,r)this.parseTrackers(),this.linkElement=document.createElement("dl"),this.linkElement.innerHTML='<dt><a href="'+this.getMagnetURI()+'"><span class="u magnet" style="background-image:url('+magnetLogoURL+');">Magnet</span></a></dt>';else{var n=this;this.linkElement=document.createElement("span"),this.linkElement.setAttribute("class","m");var a=document.createElement("a");a.setAttribute("href",this.getMagnetURI()),a.setAttribute("title","Fetching trackers..."),a.setAttribute("class","magnet"),a.innerHTML='<img src="'+magnetLogoURL+'" />',a.addEventListener("mouseover",function(){n.trackers||(n.timeout=setTimeout(function(){n.getTrackers()},100))}),a.addEventListener("mouseout",function(){n.timeout&&clearTimeout(n.timeout)}),this.linkElement.appendChild(a)}}function processResults(e){for(var t=e.querySelectorAll("dl"),r=0,n=t.length;n>r;r++){var a,s=t[r],i=s.querySelector("dt a"),o=s.querySelector("dd");i&&(a=new Torrent(i.getAttribute("href"),i.innerHTML.replace(/<[^>]*>/g,"")),o.insertBefore(a.linkElement,o.firstChild),o.style.width=parseInt(window.getComputedStyle(o).width)+50+"px")}}function processPage(e){e=e||1;var t=document.querySelectorAll(".results"),r=t.length;if(r)for(var n=0;r>n;n++)processResults(t[n]);else 100>e?setTimeout(function(){processPage(e+1)},1e3):console.log("Could not find Results... giving up")}var magnetLogoURL=chrome.extension.getURL("icon16.png");Torrent.prototype={getMagnetURI:function(){var e=this.trackers?"&tr="+this.trackers.join("&tr="):"";return"magnet:?xt=urn:btih:"+this.getHash()+"&dn="+encodeURI(this.name)+e},parseTrackers:function(e){this.trackers=[];for(var t=e?(new DOMParser).parseFromString(e,"text/html"):document,r=t.querySelectorAll(".trackers dl dt a"),n=0;n<r.length;n++)this.trackers.push(r[n].innerText)},getTrackers:function(){var e=this,t=new XMLHttpRequest;t.open("GET",this.link,!0),t.onload=function(){if(t.status>=200&&t.status<400){e.parseTrackers(t.responseText);var r=e.linkElement.querySelector("a");r.setAttribute("href",e.getMagnetURI()),r.setAttribute("title","Trackers added!"),r.style.opacity=1}},t.send()},getHash:function(){return this.link.replace(/\//g,"")}};var page="other",pathName=location.pathname.replace(/\//g,"");if(40===pathName.length)page="torrent";else{var match=pathName.match(/^(search|any|my|verified|i$|i\/)/i);match&&(page=match[1])}if("torrent"===page){var name=document.querySelector(".download h2 span").innerHTML.replace(/<[^>]*>/g,""),torrent=new Torrent(pathName,name,!0);document.querySelector(".download dl").insertAdjacentElement("afterend",torrent.linkElement)}else"other"!==page&&processPage();