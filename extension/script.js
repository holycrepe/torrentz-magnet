function TvShow(e){var t="string"==typeof e?TvShow.match(e):e;if(this.valid=null!==t,this.valid){var r=t[5];if(this.isSeason="undefined"!=typeof r,this.isSeason)return void(this.season=Number(r));var n=t[1]?1:3;this.season=Number(t[n]),this.episode=Number(t[n+1])}}function Torrent(e,t,r,n,s,i){this.link=e,this.name=t,this.size=n,this.seeds=s,this.peers=i,this.tvShow=TvShow.parse(t);var o=videoQualityRegex.exec(t);if(this.quality=o?Number(o):0,r)this.parseTrackers(),this.linkElement=document.createElement("dl"),this.linkElement.innerHTML='<dt><a href="'+this.getMagnetURI()+'"><span class="u magnet" style="background-image:url('+magnetLogoURL+');">Magnet</span></a></dt>';else{var a=this;if(this.linkElement=document.createElement("span"),this.linkElement.setAttribute("class","m"),this.quality){var l=document.createElement("div");l.setAttribute("class","video-resolution"),l.innerHTML=this.quality,this.linkElement.appendChild(l)}if(this.tvShow){var h=document.createElement("div");h.setAttribute("class","tv-show"),h.innerHTML=this.tvShow.toString(),this.linkElement.appendChild(h)}var u=document.createElement("a");u.setAttribute("href",this.getMagnetURI()),u.setAttribute("title","Fetching trackers..."),u.setAttribute("class","magnet"),u.innerHTML='<img src="'+magnetLogoURL+'" />',u.addEventListener("mouseover",function(){a.trackers||(a.timeout=setTimeout(function(){a.getTrackers()},100))}),u.addEventListener("mouseout",function(){a.timeout&&clearTimeout(a.timeout)}),this.linkElement.appendChild(u)}}function processResults(e){var t,r,n=e.querySelectorAll(">div"),s=[];for(t=0,r=n.length;r>t;t++){var i,o=n[t],a=o.querySelectorAll("> span"),l=0;i=a[l++];var h=i&&i.querySelector(">a");if(h){i=i.querySelector(">span");{i&&i.innerText||"Unknown"}i=a[l++];var u=i&&Number(i.innerText)||-1;i=a[l++];var c=i&&Number(i.innerText)||-1;i=a[l++];var d,m=i&&Utils.Strings.parseSize(i.innerText)||0;h&&(d=new Torrent(h.getAttribute("href"),h.innerText,!1,m,u,c),d.tvShow&&s.push({torrent:d,row:o}),dd.insertBefore(d.linkElement,dd.firstChild),dd.style.width=parseInt(window.getComputedStyle(dd).width)+parseInt(window.getComputedStyle(d.linkElement).width)+50+"px")}}var p=s.length;if(p){for(s.sort(function(e,t){return e.torrent.compareTo(t.torrent)}),t=p-1;t>=0;t--)e.insertBefore(s[t].row,e.firstChild);var f,g=[-1],v=s[0],S=null;for(t=p-1;t>=0;t--){var T=s[t],y=T.torrent.tvShow.getSortArray(),w=Utils.Arrays.compareTo(y,g);0!=w&&(v=T,S=s[t+1],e.insertBefore(T.row,e.firstChild),g=y)}for(s.reverse(),f=document.createElement("dl"),f.style.fontWeight="bold",f.style.backgroundColor="#004080",f.innerHTML="<dt style='color: #fff'>Highest Seeded Tv Shows</dt><dd></dd>",e.insertBefore(f,v.row),f=document.createElement("dl"),f.style.fontWeight="bold",f.style.backgroundColor="#004080",f.innerHTML="<dt style='color: #fff'>Remaining Tv Shows</dt><dd></dd>",e.insertBefore(f,S.row),t=p-1;t>=0;t--){var T=s[t],y=T.torrent.tvShow.getSortArray(),w=Utils.Arrays.compareTo(y,g);0!=w&&(f=document.createElement("dl"),f.style.fontWeight="bold",f.style.backgroundColor="#0060bf",f.innerHTML="<dt style='color: #fff'>"+T.torrent.tvShow.toString()+"</dt><dd></dd>",e.insertBefore(f,T.row),g=y)}}}function processPage(e){e=e||1;var t=document.querySelectorAll("div#main_content > div#similar_files"),r=t.length;if(r)for(var n=0;r>n;n++)processResults(t[n]);else 100>e?setTimeout(function(){processPage(e+1)},1e3):console.log("Could not find Results... giving up")}var magnetLogoURL=chrome.extension.getURL("icon16.png"),videoQualityRegex=/\b(720|1080)p?\b/i,Utils={};Utils.Arrays={flatten2:function(){var e=[].slice.call(arguments),t=[].concat.apply([],e);return t},flatten:function(e,t){var r,n=[],s=t&&e||e.slice();if(!e.length)return n;r=s.pop();do Array.isArray(r)?s.push.apply(s,r):n.push(r);while(s.length&&void 0!==(r=s.pop()));return n.reverse(),n},compareTo:function(e,t){for(var r=this.flatten(e),n=this.flatten(t),s=0,i=r.length;i>s;s++){var o=r[s]-n[s];if(0!=o)return o}return 0}},Utils.Strings={parseSize:function(e){var t=e.split(" ",2),r=t[0],n=t[1].toUpperCase(),s=["B","KB","MB","GB","TB"],i=s.indexOf(n),o=1024^i,a=r*o;return{total:a,base:r,suffix:n,summary:r+" "+n}}},Utils.Classes={compareTo:function(e,t){var r=e.getSortArray(),n=t.getSortArray();return Utils.Arrays.compareTo(r,n)}},TvShow.regex=/\b(?:S(\d{1,2})E(\d{1,3})|(\d{1,2})x(\d{1,3})|S(?:eason[ \._]?)?(\d{1,2}))\b/i,TvShow.match=function(e){return TvShow.regex.exec(e)},TvShow.parse=function(e){var t=TvShow.match(e);return t?new TvShow(t):null},TvShow.prototype={toSeasonString:function(){return"S"+(this.season<10?"0":"")+this.season},toString:function(){return this.isSeason?this.toSeasonString():this.season+"x"+(this.episode<10?"0":"")+this.episode},toStringFull:function(){return this.isSeason?"Season "+this.season:this.toSeasonString()+"E"+(this.episode<10?"0":"")+this.episode},getSortArray:function(){return[this.isSeason?0:1,this.season,this.episode]},compareTo:function(e){return Utils.Classes.compareTo(this,e)}},Torrent.patterns=function(){var e="\b([a-zd]{40})\b",t="/"+e+"/";return{hash:new RegExp(e,"gi"),hashLink:new RegExp(t,"gi")}}(),Torrent.prototype={getMagnetURI:function(){var e=this.trackers?"&tr="+this.trackers.join("&tr="):"";return"magnet:?xt=urn:btih:"+this.getHash()+"&dn="+encodeURI(this.name)+e},parseTrackers:function(e){this.trackers=[];for(var t=e?(new DOMParser).parseFromString(e,"text/html"):document,r=t.querySelectorAll(".trackers dl dt a"),n=0;n<r.length;n++)this.trackers.push(r[n].innerText)},getTrackers:function(){var e=this,t=new XMLHttpRequest;t.open("GET",this.link,!0),t.onload=function(){if(t.status>=200&&t.status<400){e.parseTrackers(t.responseText);var r=e.linkElement.querySelector("a");r.setAttribute("href",e.getMagnetURI()),r.setAttribute("title","Trackers added!"),r.style.opacity=1}},t.send()},getHash:function(){var e=Torrent.patterns.hashLink.match(this.link.href);return e?e[1]:""},getSortArray:function(){var e=this.tvShow.getSortArray();return[e,[this.seeds?-1*this.seeds:0]]},compareTo:function(e){return Utils.Classes.compareTo(this,e)}};var page="other",pathName=location.pathname.replace(/\//g,"");if(40===pathName.length)page="torrent";else{var match=pathName.match(/^(search|any|my|verified|i$|i\/)/i);match&&(page=match[1])}if("torrent"===page){var name=document.querySelector(".download h2 span").innerHTML.replace(/<[^>]*>/g,""),torrent=new Torrent(pathName,name,!0);document.querySelector(".download dl").insertAdjacentElement("afterend",torrent.linkElement)}else"other"!==page&&processPage();